<h3>ショッピングカード</h3>
<div class="col-xs-11", id="no-cart">
  <% if @cart_items.present? %>
    <%= link_to "カートを空にする", cart_items_path, method: :delete, data: {confirm: "カートを空にしてよろしいですか？" }, class: "btn btn-danger" %>
    <table class="table table-hover table-bordered">
      <tr>
        <td>商品名</td>
        <td>単価(税込)</td>
        <td>数量</td>
        <td>小計</td>
        <td></td>
      </tr>
      <% @cart_items.each do |i| %>
        <tr id="cart-<%= i.id %>">
          <td>
            <%= attachment_image_tag i.item, :image, :fill, 20, 20, format:"jpg", fallback: "no_image.jpg", class:"icon" %>
            <%= i.item.name %>
          </td>
          <td>
            <%= i.item.tax_in_price.to_s(:delimited, delimiter: ",") %>
          </td>
          <td>
            <%= form_with model:i, url: cart_item_path(i), method: :patch, remote: true do |f| %>
              <%= f.number_field :count, size: 10, min: 1 %>
              <%= f.submit "変更", class:"btn btn-success" %>
            <% end %>
          </td>
          <td>
            <%= subtotal(i).to_s(:delimited, delimiter: ",") %>
          </td>
          <td>
            <%= link_to "削除する", cart_item_path(i), method: :delete, remote: true, data: {confirm: "#{i.item.name}を削除してもよろしいですか？"}, class: "btn btn-danger" %>
          </td>
        </tr>
      <% end %>
    </table>
    <%= link_to "買物を続ける", root_path, class: "btn btn-info" %>
    <table class="table-bordered text-right">
      <tr>
        <td>合計金額</td>
        <td id="total_price">
          <%= total_price(@cart_items).to_s(:delimited, delimiter: ",") %>
        </td>
      </tr>
    </table>
    <%= link_to "情報入力に進む", new_order_path, class:"btn btn-success mx-auto" %>

  <% else %>
    <%= render 'no_cart' %>
  <% end %>
</div>
